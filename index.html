<!DOCTYPE html>
<!-- Author: Martin ABADIE martin-abadie.fr -->
<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>PiThermalMonitoring</title>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <style>
        .temperature {
            font-family: Verdana, Geneva, sans-serif;
            text-align: center;
            margin-top: 50vh;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <div class="temperature"></div>

    <script type="text/javascript">

        let socket;

        $('document').ready(function() {
            socket = io.connect("http://node.thermal.martin-abadie.fr");
            if(socket) {
                console.log('Connected!');

                var id = window.setInterval(function() {
                    if(socket) {
                        console.log('Querying...');
                        socket.emit('message', 'temp?');
                    }
                }, 300);

                socket.on('message', function(message) {
                    console.log(message);
                    $('.temperature').html(message + 'Â°C');
                });

                socket.on('disconnect', function() {
                    clearInterval(id);
                    console.log('Server close');
                })
            } else {
                console.log('Connection failed');
            }
        });

        function sendQuery() {
            socket.emit('message', 'temp?');
            console.log('Query sent');
        }
    </script>
</body>
</html>